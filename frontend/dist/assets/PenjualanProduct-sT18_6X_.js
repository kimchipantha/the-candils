import{d as tt,a as d,o as u,b as t,f as j,e as V,B as rt,F as W,r as X,t as i,n as lt,g as ct,h,c as Z,w as nt,i as O,j as it,v as ft,k as yt,m as pt,C as mt,q as xt,x as et,D as kt,E as bt,G as vt,H as dt,I as ht,J as wt,K as Dt,L as Pt,M as Lt}from"./index-BWtGjQtB.js";import{u as U,w as gt,r as It}from"./xlsx-DSqvgYLF.js";const Ct={class:"bg-white rounded-xl shadow-lg p-6"},Tt={class:"flex flex-col lg:flex-row lg:items-center lg:justify-between mb-6"},$t={class:"mt-4 lg:mt-0 flex gap-2"},St={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},_t=["value","max"],Nt=["value","min","max"],At=["value"],Bt=["value"],jt=["value"],Mt={class:"overflow-x-auto"},Rt={class:"w-full"},Et={class:"bg-white divide-y divide-gray-200"},Vt={class:"px-4 py-3 text-sm text-gray-900"},Ut={class:"px-4 py-3 text-sm font-medium text-gray-900"},Ht={class:"px-4 py-3 text-sm text-gray-700"},Ft={key:0,class:"bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs font-medium"},Qt={key:1},Yt={class:"px-4 py-3 text-sm text-gray-700"},Ot={class:"px-4 py-3 text-sm text-gray-700"},zt={class:"px-4 py-3 text-sm text-gray-700"},Kt={class:"px-4 py-3 text-sm text-gray-700"},qt={class:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full"},Gt={class:"px-4 py-3 text-sm text-gray-700"},Jt={class:"px-4 py-3 flex items-center gap-2"},Wt=["onClick"],Xt=["onClick"],Zt={key:0,class:"text-center py-10 text-gray-500"},te={key:1,class:"flex items-center justify-between mt-6"},ee={class:"text-sm text-gray-700"},ae={class:"flex gap-2"},se=["disabled"],oe=["disabled"],le=tt({__name:"SalesTable",props:{reportData:{},isLoading:{type:Boolean},filters:{},lokasiList:{},currentPage:{},totalPages:{},totalReports:{},itemsPerPage:{}},emits:["updateFilters","next-page","previous-page","addReport","editSale","deleteSale","openImport","exportData"],setup(R,{emit:P}){const p=P,w=(e,a)=>{p("updateFilters",{[e]:a})},c=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),x=e=>new Date(e).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}),S=e=>p("editSale",e),I=e=>p("deleteSale",e);function C(e){return console.log("Order type from backend:",e),(e?e.toLowerCase():"online").includes("offline")?"bg-pink-100 text-pink-800 border border-pink-300":"bg-indigo-100 text-indigo-800 border border-indigo-300"}const N=new Date().toISOString().split("T")[0];return(e,a)=>(u(),d("div",Ct,[t("div",Tt,[a[10]||(a[10]=t("div",null,[t("h2",{class:"text-2xl font-bold text-gray-800"},"Laporan Penjualan"),t("p",{class:"text-gray-600 mt-1"},"Data penjualan produk per lokasi")],-1)),t("div",$t,[t("button",{onClick:a[0]||(a[0]=s=>e.$emit("exportData")),class:"bg-[#BAB772] text-white px-4 py-2 rounded-lg hover:bg-[#a8a668] flex items-center gap-2"},[...a[8]||(a[8]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),V(" Export Data ",-1)])]),t("button",{onClick:a[1]||(a[1]=s=>e.$emit("openImport")),class:"bg-[#BAB772] text-white px-4 py-2 rounded-lg hover:bg-[#a8a668] flex items-center gap-2"},[...a[9]||(a[9]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),V(" Import Data ",-1)])])])]),t("div",St,[t("div",null,[a[11]||(a[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Dari Tanggal",-1)),t("input",{value:e.filters.startDate,max:rt(N),onChange:a[2]||(a[2]=s=>w("startDate",s.target.value)),type:"date",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#BAB772] focus:border-transparent"},null,40,_t)]),t("div",null,[a[12]||(a[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Sampai Tanggal",-1)),t("input",{value:e.filters.endDate,min:e.filters.startDate,max:rt(N),onChange:a[3]||(a[3]=s=>w("endDate",s.target.value)),type:"date",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#BAB772] focus:border-transparent"},null,40,Nt)]),t("div",null,[a[14]||(a[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Lokasi",-1)),t("select",{value:e.filters.lokasiName,onChange:a[4]||(a[4]=s=>w("lokasiName",s.target.value)),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#BAB772] focus:border-transparent"},[a[13]||(a[13]=t("option",{value:"all"},"Semua Lokasi",-1)),(u(!0),d(W,null,X(e.lokasiList,s=>(u(),d("option",{key:s.lokasiId,value:s.name||s.namaLokasi},i(s.name||s.namaLokasi),9,Bt))),128))],40,At)]),t("div",null,[a[16]||(a[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Tipe Pesanan",-1)),t("select",{value:e.filters.tipePesanan,onChange:a[5]||(a[5]=s=>w("tipePesanan",s.target.value)),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#BAB772] focus:border-transparent"},[...a[15]||(a[15]=[t("option",{value:"all"},"Semua Tipe",-1),t("option",{value:"Online"},"Online",-1),t("option",{value:"Offline"},"Offline",-1)])],40,jt)])]),t("div",Mt,[t("table",Rt,[a[20]||(a[20]=t("thead",null,[t("tr",{class:"bg-gray-50 border-b border-gray-200"},[t("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700"},"NO"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700"},"NAMA PRODUK"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700"},"UKURAN"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700"},"QTY"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700"},"TOTAL HARGA"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700"},"TIPE PESANAN"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700"},"LOKASI"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700"},"DATE"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700"},"AKSI")])],-1)),t("tbody",Et,[e.isLoading?(u(!0),d(W,{key:0},X(e.itemsPerPage,s=>(u(),d("tr",{key:"skeleton-"+s,class:"animate-pulse"},[...a[17]||(a[17]=[t("td",{class:"px-4 py-4"},[t("div",{class:"h-4 bg-gray-200 rounded w-8"})],-1),t("td",{class:"px-4 py-4"},[t("div",{class:"h-4 bg-gray-200 rounded w-32"})],-1),t("td",{class:"px-4 py-4"},[t("div",{class:"h-4 bg-gray-200 rounded w-16"})],-1),t("td",{class:"px-4 py-4"},[t("div",{class:"h-4 bg-gray-200 rounded w-12"})],-1),t("td",{class:"px-4 py-4"},[t("div",{class:"h-4 bg-gray-200 rounded w-24"})],-1),t("td",{class:"px-4 py-4"},[t("div",{class:"h-4 bg-gray-200 rounded w-20"})],-1),t("td",{class:"px-4 py-4"},[t("div",{class:"h-6 bg-gray-200 rounded-full w-20"})],-1),t("td",{class:"px-4 py-4"},[t("div",{class:"h-4 bg-gray-200 rounded w-24"})],-1),t("td",{class:"px-4 py-4"},[t("div",{class:"flex gap-2"},[t("div",{class:"h-4 bg-gray-200 rounded w-4"}),t("div",{class:"h-4 bg-gray-200 rounded w-4"})])],-1)])]))),128)):(u(!0),d(W,{key:1},X(e.reportData,(s,m)=>(u(),d("tr",{key:m,class:"hover:bg-gray-50 transition-colors"},[t("td",Vt,i((e.currentPage-1)*e.itemsPerPage+m+1),1),t("td",Ut,i(s.namaProduk),1),t("td",Ht,[s.ukuran?(u(),d("span",Ft,i(s.ukuran),1)):(u(),d("span",Qt,"-"))]),t("td",Yt,i(s.QTY),1),t("td",Ot,i(c(s.totalHarga)),1),t("td",zt,[t("span",{class:lt([C(s.tipePesanan),"text-xs font-medium px-2 py-1 rounded"])},i(s.tipePesanan?s.tipePesanan:"Online"),3)]),t("td",Kt,[t("span",qt,i(s.lokasi),1)]),t("td",Gt,i(x(s.date)),1),t("td",Jt,[t("button",{onClick:l=>S(s),class:"text-blue-600 hover:text-blue-800",title:"Edit Laporan"},[...a[18]||(a[18]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Wt),t("button",{onClick:l=>I(s),class:"text-red-600 hover:text-red-800",title:"Hapus Laporan"},[...a[19]||(a[19]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Xt)])]))),128))])])]),!e.isLoading&&e.reportData.length===0?(u(),d("div",Zt," Tidak ada data penjualan yang ditemukan untuk filter ini. ")):j("",!0),!e.isLoading&&e.reportData.length>0?(u(),d("div",te,[t("div",ee," Menampilkan "+i((e.currentPage-1)*e.itemsPerPage+1)+" - "+i(Math.min(e.currentPage*e.itemsPerPage,e.totalReports))+" dari "+i(e.totalReports)+" data ",1),t("div",ae,[t("button",{onClick:a[6]||(a[6]=s=>e.$emit("previous-page")),disabled:e.currentPage===1,class:"px-3 py-2 text-sm border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"}," Previous ",8,se),t("button",{onClick:a[7]||(a[7]=s=>e.$emit("next-page")),disabled:e.currentPage*e.itemsPerPage>=e.totalReports,class:"px-3 py-2 text-sm border border-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50"}," Next ",8,oe)])])):j("",!0)]))}}),ne={class:"flex items-center justify-between mb-6"},re={class:"text-2xl font-bold text-gray-800"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},de=["value"],ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ce=["value"],pe=["value"],me={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ge={class:"relative"},fe=["value"],ye={class:"relative"},xe=["value"],ke={class:"flex justify-end gap-4 pt-4"},be=["disabled"],ve=tt({__name:"EditReportModal",props:{isVisible:{type:Boolean},saleData:{},masterProductList:{},lokasiList:{}},emits:["close","submit"],setup(R,{emit:P}){const p=R,w=P,c=ct({QTY:1,lokasi:"",unitPrice:0}),x=h(!1),S=Z(()=>p.saleData&&p.saleData.QTY>0?p.saleData.totalHarga/p.saleData.QTY:0);nt(()=>p.saleData,m=>{m&&(c.QTY=m.QTY,c.lokasi=m.lokasi,c.unitPrice=S.value)},{immediate:!0});const I=Z(()=>c.QTY*c.unitPrice),C=m=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(m),N=Z(()=>C(I.value)),e=()=>w("close"),a=()=>e(),s=async()=>{if(!p.saleData||!c.lokasi||c.QTY<=0||c.unitPrice<=0){alert("Mohon lengkapi semua field dan pastikan kuantitas > 0");return}x.value=!0;try{const m=p.lokasiList.find(L=>(L.name||L.namaLokasi)===c.lokasi);if(!m||!m.lokasiId&&!m.id){alert("Gagal menemukan ID lokasi yang sesuai. Pilih lokasi yang valid."),x.value=!1;return}const l={pesananId:p.saleData.pesananId,produkId:p.saleData.produkId,namaProduk:p.saleData.namaProduk,date:p.saleData.date,QTY:c.QTY,lokasi:c.lokasi,totalHarga:I.value};w("submit",l)}catch(m){console.error("Error submitting form:",m)}finally{x.value=!1}};return(m,l)=>m.isVisible?(u(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center",style:{"background-color":"rgba(0, 0, 0, 0.7)"},onClick:a},[t("div",{class:"bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 p-6",onClick:l[2]||(l[2]=O(()=>{},["stop"]))},[t("div",ne,[t("h2",re,"Edit Laporan #"+i(m.saleData?.pesananId),1),t("button",{onClick:e,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...l[3]||(l[3]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:O(s,["prevent"]),class:"space-y-6"},[t("div",ie,[t("div",null,[l[4]||(l[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"NAMA PRODUK",-1)),t("input",{value:m.saleData?.namaProduk,type:"text",disabled:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"},null,8,de)]),t("div",null,[l[5]||(l[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"KUANTITAS",-1)),it(t("input",{"onUpdate:modelValue":l[0]||(l[0]=L=>c.QTY=L),type:"number",min:"1",required:"",placeholder:"0",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#BAB772] focus:border-transparent"},null,512),[[ft,c.QTY,void 0,{number:!0}]])])]),t("div",ue,[t("div",null,[l[7]||(l[7]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"LOKASI",-1)),it(t("select",{"onUpdate:modelValue":l[1]||(l[1]=L=>c.lokasi=L),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#BAB772] focus:border-transparent"},[l[6]||(l[6]=t("option",{value:""},"Pilih lokasi",-1)),(u(!0),d(W,null,X(m.lokasiList,L=>(u(),d("option",{key:L.lokasiId||L.id,value:L.name||L.namaLokasi},i(L.name||L.namaLokasi),9,ce))),128))],512),[[yt,c.lokasi]])]),t("div",null,[l[8]||(l[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"DATE",-1)),t("input",{value:m.saleData?.date,type:"date",disabled:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"},null,8,pe)])]),t("div",me,[t("div",null,[l[10]||(l[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"HARGA SATUAN",-1)),t("div",ge,[l[9]||(l[9]=t("span",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"},"Rp",-1)),t("input",{value:C(c.unitPrice),type:"text",disabled:"",class:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed"},null,8,fe)])]),t("div",null,[l[12]||(l[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"TOTAL HARGA",-1)),t("div",ye,[l[11]||(l[11]=t("span",{class:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"},"Rp",-1)),t("input",{value:N.value,type:"text",disabled:"",class:"w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg bg-gray-50 cursor-not-allowed"},null,8,xe)])])]),t("div",ke,[t("button",{type:"button",onClick:e,class:"px-6 py-3 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600"},"BATALKAN"),t("button",{type:"submit",disabled:x.value,class:"px-6 py-3 bg-[#BAB772] text-white rounded-lg font-medium hover:bg-[#a8a668] disabled:opacity-50"},i(x.value?"Menyimpan...":"UPDATE"),9,be)])],32)])])):j("",!0)}}),he={class:"mb-6"},we={key:0,class:"bg-gray-50 rounded-lg p-4 text-sm text-gray-600 space-y-2"},De={class:"flex justify-between"},Pe={class:"font-medium"},Le={class:"flex justify-between"},Ie={class:"font-medium"},Ce={class:"flex justify-between"},Te={class:"font-medium"},$e={class:"flex justify-between"},Se={class:"font-medium"},_e={class:"flex justify-end gap-4"},Ne=["disabled"],Ae=tt({__name:"DeleteConfirmModal",props:{isVisible:{type:Boolean},saleData:{}},emits:["close","confirm"],setup(R,{emit:P}){const p=R,w=P,c=h(!1),x=()=>{w("close")},S=()=>{x()},I=async()=>{if(p.saleData){c.value=!0;try{w("confirm",p.saleData)}catch(e){console.error("Error in delete confirmation:",e)}finally{c.value=!1}}},C=e=>typeof e!="number"||isNaN(e)?"Rp -":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),N=e=>e?new Date(e).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}):"";return(e,a)=>e.isVisible?(u(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center",style:{"background-color":"rgba(0, 0, 0, 0.7)"},onClick:S},[t("div",{class:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 p-6",onClick:a[0]||(a[0]=O(()=>{},["stop"]))},[t("div",{class:"flex items-center justify-between mb-6"},[a[2]||(a[2]=t("h2",{class:"text-xl font-bold text-gray-800"},"Konfirmasi Hapus",-1)),t("button",{onClick:x,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...a[1]||(a[1]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",he,[a[8]||(a[8]=pt('<div class="flex items-center mb-4"><div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4"><svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg></div><div><h3 class="text-lg font-semibold text-gray-800">Hapus Data Penjualan</h3><p class="text-sm text-gray-600">Tindakan ini tidak dapat dibatalkan</p></div></div>',1)),e.saleData?(u(),d("div",we,[a[7]||(a[7]=t("h4",{class:"font-medium text-gray-800 mb-2"},"Detail yang akan dihapus:",-1)),t("div",De,[a[3]||(a[3]=t("span",null,"Produk:",-1)),t("span",Pe,i(e.saleData.namaProduk),1)]),t("div",Le,[a[4]||(a[4]=t("span",null,"Total Harga:",-1)),t("span",Ie,i(C(e.saleData.totalHarga)),1)]),t("div",Ce,[a[5]||(a[5]=t("span",null,"Lokasi:",-1)),t("span",Te,i(e.saleData.lokasi),1)]),t("div",$e,[a[6]||(a[6]=t("span",null,"Tanggal:",-1)),t("span",Se,i(N(e.saleData.date)),1)])])):j("",!0)]),t("div",_e,[t("button",{type:"button",onClick:x,class:"px-6 py-3 bg-gray-500 text-white rounded-lg font-medium hover:bg-gray-600 transition-colors duration-200"}," BATALKAN "),t("button",{type:"button",onClick:I,disabled:c.value,class:"px-6 py-3 bg-red-500 text-white rounded-lg font-medium hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200"},i(c.value?"Menghapus...":"HAPUS"),9,Ne)])])])):j("",!0)}}),Be={class:"flex-1 overflow-hidden flex flex-col p-6"},je={key:1,class:"flex-1 flex flex-col h-full overflow-hidden"},Me={class:"flex items-center justify-between mb-4"},Re={class:"flex space-x-4 text-sm"},Ee={class:"px-3 py-1 bg-gray-100 rounded-full text-gray-700"},Ve={class:"px-3 py-1 bg-green-100 rounded-full text-green-700"},Ue={class:"px-3 py-1 bg-red-100 rounded-full text-red-700"},He={class:"flex-1 overflow-auto border border-gray-200 rounded-lg"},Fe={class:"w-full text-sm text-left"},Qe={class:"px-6 py-4 font-medium text-gray-900"},Ye={class:"px-6 py-4"},Oe={key:0,class:"text-xs text-red-500 mt-1"},ze={class:"px-6 py-4"},Ke={key:0,class:"text-xs text-red-500 mt-1"},qe={class:"px-6 py-4"},Ge={key:0,class:"text-gray-700 bg-gray-100 px-2 py-1 rounded text-xs"},Je={key:1,class:"text-xs text-red-500"},We={class:"px-6 py-4"},Xe={class:"px-6 py-4"},Ze={class:"px-6 py-4"},ta={class:"px-6 py-4"},ea={key:0,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"},aa={key:1,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800"},sa={class:"p-6 border-t border-gray-100 bg-gray-50 rounded-b-xl flex justify-end gap-3"},oa=["disabled"],la={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},na=tt({__name:"ImportSalesModal",props:{isVisible:{type:Boolean},productList:{},lokasiList:{},ukuranList:{}},emits:["close","import-success"],setup(R,{emit:P}){const p=R,w=P,c=mt(),x=h([]),S=h(!1),I=()=>{const f=["Lokasi","Nama Produk","Ukuran","QTY","Tanggal"],n=[["Ciputat","Hijau Hitam Legenda","300ml",2,"2025-01-01"],["Pamulang","Sumsum Pandan Lembut","500ml",1,"2025-01-02"]],b=U.aoa_to_sheet([f,...n]),$=U.book_new();U.book_append_sheet($,b,"Template"),gt($,"Template_Import_Penjualan.xlsx")},C=Z(()=>x.value.filter(f=>f.isValid).length),N=Z(()=>x.value.filter(f=>!f.isValid).length),e=()=>{s(),w("close")},a=()=>e(),s=()=>{x.value=[]},m=f=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(f),l=f=>{const n=f.target;n.files&&n.files[0]&&M(n.files[0])},L=f=>{f.dataTransfer?.files&&f.dataTransfer.files[0]&&M(f.dataTransfer.files[0])},M=async f=>{const n=await f.arrayBuffer(),b=It(n),$=b.SheetNames[0],K=b.Sheets[$],q=U.sheet_to_json(K,{cellDates:!0});if(!q||q.length===0){c.error("File Excel kosong atau format salah.");return}const at=g=>{if(!g)return new Date().toISOString().split("T")[0];if(g instanceof Date){const H=g.getFullYear(),F=String(g.getMonth()+1).padStart(2,"0"),Q=String(g.getDate()).padStart(2,"0");return`${H}-${F}-${Q}`}return String(g)};x.value=q.map(g=>{const H=g.Lokasi||g.lokasi||g.Location||"",F=g["Nama Produk"]||g["nama produk"]||g.Product||g.Produk||"",Q=g.Ukuran||g.ukuran||g.Size||"",Y=Number(g.QTY||g.qty||g.Quantity||1),st=g["Nama Pelanggan"]||g.Pelanggan||"-";let ot=at(g.Tanggal||g.Date);const G=p.lokasiList.find(r=>(r.name||r.namaLokasi||"").toLowerCase()===String(H).toLowerCase()),A=p.productList.find(r=>(r.namaProduk||r.name||"").toLowerCase()===String(F).toLowerCase());let o=null,y=0;if(A){const r=p.ukuranList.filter(v=>v.produkId===A.produkId||v.produkId===A.id);if(Q){const v=r.find(B=>B.namaUkuran?.toLowerCase()===String(Q).toLowerCase());v&&(o=v.ukuranId,y=v.hargaTambahan||0)}if(!o&&r.length>0){const v=r.find(B=>{const J=B.namaUkuran?.toLowerCase();return J==="300ml"||J==="regular"||J==="standar"});v?(o=v.ukuranId,y=v.hargaTambahan||0):(o=r[0].ukuranId,y=r[0].hargaTambahan||0)}}const D=!!(G&&A&&Y>0&&o),k=A?Number(A.harga||A.price||0):0,_=Number(y||0),T=k+_,E=(isNaN(T)?0:T)*(isNaN(Y)?0:Y);return{rawLokasi:H,rawProduk:F,qty:Y,rawPelanggan:st,rawDate:ot,lokasiId:G?.lokasiId||G?.id,produkId:A?.produkId||A?.id,ukuranId:o,unitPrice:T,estimatedTotal:E,isValid:D}})},z=()=>{S.value=!0;const f=x.value.filter(n=>n.isValid);w("import-success",f)};return(f,n)=>f.isVisible?(u(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 sm:p-6",style:{"background-color":"rgba(0, 0, 0, 0.7)"},onClick:a},[t("div",{class:"bg-white rounded-xl shadow-2xl w-full max-w-5xl h-[80vh] flex flex-col",onClick:n[1]||(n[1]=O(()=>{},["stop"]))},[t("div",{class:"flex items-center justify-between p-6 border-b border-gray-100"},[n[4]||(n[4]=t("div",null,[t("h2",{class:"text-2xl font-bold text-gray-800"},"Import Data Penjualan"),t("p",{class:"text-sm text-gray-500 mt-1"},"Upload file Excel (.xlsx, .xls) untuk import data massal.")],-1)),t("div",{class:"flex items-center gap-3"},[t("button",{onClick:I,class:"text-sm text-[#BAB772] hover:text-[#a8a668] font-medium flex items-center gap-2 px-3 py-2 bg-[#BAB772]/10 rounded-lg transition-colors"},[...n[2]||(n[2]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),V(" Download Template ",-1)])]),t("button",{onClick:e,class:"text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-full"},[...n[3]||(n[3]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),t("div",Be,[x.value.length===0?(u(),d("div",{key:0,class:"flex-1 flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-xl bg-gray-50 hover:bg-gray-100 transition-colors cursor-pointer group relative",onDragover:n[0]||(n[0]=O(()=>{},["prevent"])),onDrop:O(L,["prevent"])},[t("input",{type:"file",accept:".xlsx, .xls",class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",onChange:l},null,32),n[5]||(n[5]=pt('<div class="text-center p-10"><div class="w-16 h-16 bg-[#BAB772] text-white rounded-full flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition-transform"><svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><h3 class="text-lg font-medium text-gray-900">Klik atau Drag &amp; Drop file Excel di sini</h3><p class="text-sm text-gray-500 mt-2">Format kolom: Lokasi, Nama Produk, QTY, Nama Pelanggan (opsional), Tanggal (opsional)</p></div>',1))],32)):(u(),d("div",je,[t("div",Me,[t("div",Re,[t("span",Ee,[n[6]||(n[6]=V("Total: ",-1)),t("b",null,i(x.value.length),1)]),t("span",Ve,[n[7]||(n[7]=V("Valid: ",-1)),t("b",null,i(C.value),1)]),t("span",Ue,[n[8]||(n[8]=V("Invalid: ",-1)),t("b",null,i(N.value),1)])]),t("button",{onClick:s,class:"text-sm text-red-600 hover:text-red-800 font-medium"},"Reset / Upload Ulang")]),t("div",He,[t("table",Fe,[n[9]||(n[9]=t("thead",{class:"text-xs text-gray-700 uppercase bg-gray-50 sticky top-0 z-10"},[t("tr",null,[t("th",{class:"px-6 py-3"},"No"),t("th",{class:"px-6 py-3"},"Lokasi"),t("th",{class:"px-6 py-3"},"Nama Produk"),t("th",{class:"px-6 py-3"},"Ukuran"),t("th",{class:"px-6 py-3"},"QTY"),t("th",{class:"px-6 py-3"},"Tanggal"),t("th",{class:"px-6 py-3"},"Estimasi Total"),t("th",{class:"px-6 py-3"},"Status")])],-1)),t("tbody",null,[(u(!0),d(W,null,X(x.value,(b,$)=>(u(),d("tr",{key:$,class:"bg-white border-b hover:bg-gray-50"},[t("td",Qe,i($+1),1),t("td",Ye,[t("span",{class:lt({"text-red-600 font-bold":!b.lokasiId})},i(b.rawLokasi),3),b.lokasiId?j("",!0):(u(),d("div",Oe,"Lokasi tidak ditemukan"))]),t("td",ze,[t("span",{class:lt({"text-red-600 font-bold":!b.produkId})},i(b.rawProduk),3),b.produkId?j("",!0):(u(),d("div",Ke,"Produk tidak ditemukan"))]),t("td",qe,[b.ukuranId?(u(),d("span",Ge,i(p.ukuranList.find(K=>K.ukuranId===b.ukuranId)?.namaUkuran||"-"),1)):(u(),d("span",Je,"Ukuran invalid"))]),t("td",We,i(b.qty),1),t("td",Xe,i(b.rawDate),1),t("td",Ze,i(m(b.estimatedTotal)),1),t("td",ta,[b.isValid?(u(),d("span",ea,"Available")):(u(),d("span",aa,"Invalid"))])]))),128))])])])]))]),t("div",sa,[t("button",{type:"button",onClick:e,class:"px-5 py-2.5 bg-white border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 shadow-sm transition-all text-sm"}," Batal "),t("button",{type:"button",onClick:z,disabled:S.value||C.value===0,class:"px-5 py-2.5 bg-[#BAB772] text-white rounded-lg font-medium hover:bg-[#a8a668] shadow-sm transition-all text-sm flex items-center disabled:opacity-50 disabled:cursor-not-allowed"},[S.value?(u(),d("svg",la,[...n[10]||(n[10]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):j("",!0),V(" "+i(S.value?"Memproses Import...":`Import ${C.value} Data Valid`),1)],8,oa)])])])):j("",!0)}}),ra={class:"p-8 bg-gray-50 min-h-screen"},ia={key:0,class:"bg-red-50 border border-red-200 rounded-lg p-6 text-center"},da={class:"text-red-500"},ua={key:1},ut=10,ma=tt({__name:"PenjualanProduct",setup(R){const P=mt(),p=h(!1),w=h(null),c=h([]),x=h([]),S=h([]),I=h([]),C=h([]),N=h([]),e=ct({startDate:"",endDate:"",lokasiName:"all",tipePesanan:"all"}),a=h(1),s=h(!1),m=h(!1),l=h(!1),L=h(null),M=h(null),z=h(0),f=h(1),n=async()=>{try{const[o,y,D]=await Promise.all([kt(),bt(),vt()]);I.value=o.data,N.value=D.data,C.value=y.data.map(k=>({...k,name:k.namaProduk,price:k.harga}))}catch(o){console.error("Error fetching master data:",o)}},b=async()=>{p.value=!0,w.value=null;try{let o="all";if(e.lokasiName&&e.lokasiName!=="all"){const r=e.lokasiName.toLowerCase(),v=I.value.find(B=>(B.name||B.namaLokasi||"").toLowerCase()===r);o=v?.lokasiId||v?.id||"all"}const y=new URLSearchParams({startDate:e.startDate,endDate:e.endDate,lokasiId:String(o),tipePesanan:e.tipePesanan,page:String(a.value),limit:String(ut)}).toString(),[D,k,_]=await Promise.all([dt(y),ht(),wt()]),T=D.data,E=k.data;T.success&&Array.isArray(T.data)?(c.value=T.data.map(r=>({pesananId:Number(r.pesananId||r.pesananid),produkId:Number(r.produkId||0),namaProduk:r.namaProduk,ukuran:r.namaUkuran||"-",QTY:Number(r.QTY),totalHarga:Number(r.totalHarga),lokasi:r.lokasi,date:r.date,tipePesanan:r.tipePesanan})),"meta"in T&&T.meta&&(z.value=T.meta.totalItems,f.value=T.meta.totalPages)):(c.value=[],z.value=0,f.value=1,w.value=T.message||"Data laporan tidak valid atau kosong."),E.success&&(x.value=E.data),S.value=_.data.data}catch(o){console.error("Error fetching sales data:",o),w.value=o.response?.data?.message||"Gagal terhubung ke server laporan."}finally{p.value=!1}};nt(e,()=>{a.value=1,b()},{deep:!0}),nt(a,b);const $=()=>{b(),n()},K=o=>{Object.assign(e,o)},q=()=>{a.value<f.value&&a.value++},at=()=>{a.value>1&&a.value--},g=()=>{},H=o=>{L.value={...o},s.value=!0},F=()=>{s.value=!1},Q=async o=>{try{const y=I.value.find(_=>(_.name?.toLowerCase()||_.namaLokasi?.toLowerCase())===o.lokasi.toLowerCase()),D=y?.lokasiId||y?.id;if(!D)throw new Error("ID Lokasi tidak ditemukan.");const k={quantity:o.QTY,hargaSatuan:o.totalHarga/o.QTY,lokasiId:D};await Dt(o.pesananId,o.produkId,k),P.success("Laporan penjualan berhasil diperbarui."),s.value=!1,await $()}catch(y){console.error("Error updating sale:",y),P.error("Gagal memperbarui laporan.")}},Y=o=>{M.value=o,m.value=!0},st=()=>{m.value=!1},ot=async()=>{if(M.value)try{await Pt(M.value.pesananId,M.value.produkId),P.success("Transaksi penjualan berhasil dihapus."),m.value=!1,await $()}catch(o){console.error("Error deleting sale:",o),P.error("Gagal menghapus transaksi.")}},G=async()=>{try{P.info("Sedang menyiapkan data export...");let o="all";if(e.lokasiName&&e.lokasiName!=="all"){const r=e.lokasiName.toLowerCase(),v=I.value.find(B=>(B.name||B.namaLokasi||"").toLowerCase()===r);o=v?.lokasiId||v?.id||"all"}const y=new URLSearchParams({startDate:e.startDate,endDate:e.endDate,lokasiId:String(o),tipePesanan:e.tipePesanan,page:"1",limit:"999999"}).toString(),D=await dt(y);if(!D.data||!D.data.success||!Array.isArray(D.data.data))throw new Error("Gagal mengambil data untuk export.");const k=D.data.data;if(k.length===0){P.warning("Tidak ada data untuk diexport.");return}const _=k.map((r,v)=>({No:v+1,Lokasi:r.lokasi,"Nama Produk":r.namaProduk,Ukuran:r.namaUkuran||"-",QTY:Number(r.QTY),"Total Harga":Number(r.totalHarga),"Tipe Pesanan":r.tipePesanan||"Online",Tanggal:r.date})),T=U.json_to_sheet(_),E=U.book_new();U.book_append_sheet(E,T,"Laporan Penjualan"),gt(E,`Laporan_Penjualan_${new Date().toISOString().slice(0,10)}.xlsx`),P.success("Berhasil download file Excel.")}catch(o){console.error("Export failed:",o),P.error("Gagal melakukan export data.")}},A=async o=>{let y=0,D=0;for(const k of o)try{const _={lokasiId:k.lokasiId,namaPelanggan:k.rawPelanggan||"-",kontakPelanggan:"-",alamatPengiriman:"-",tanggalPesanan:k.rawDate,totalHarga:k.estimatedTotal,items:[{produkId:k.produkId,ukuranId:k.ukuranId,quantity:k.qty,subtotal:k.estimatedTotal}]};await Lt(_),y++}catch(_){console.error("Failed to import row",k,_),D++}y>0&&(P.success(`Berhasil mengimpor ${y} data transaksi.`),l.value=!1,$()),D>0&&P.warning(`${D} data gagal diimpor. Cek console.`)};return xt(()=>{$()}),(o,y)=>(u(),d("div",ra,[w.value?(u(),d("div",ia,[t("p",da,i(w.value),1),t("button",{onClick:$,class:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 mt-4"}," Coba Lagi ")])):(u(),d("div",ua,[et(le,{"report-data":c.value,"is-loading":p.value,filters:e,"lokasi-list":I.value,"current-page":a.value,"total-pages":f.value,"total-reports":z.value,"items-per-page":ut,onUpdateFilters:K,onNextPage:q,onPreviousPage:at,onAddReport:g,onOpenImport:y[0]||(y[0]=D=>l.value=!0),onExportData:G,onEditSale:H,onDeleteSale:Y},null,8,["report-data","is-loading","filters","lokasi-list","current-page","total-pages","total-reports","onEditSale","onDeleteSale"])])),et(ve,{"is-visible":s.value,"sale-data":L.value,"master-product-list":C.value,"lokasi-list":I.value,onClose:F,onSubmit:Q},null,8,["is-visible","sale-data","master-product-list","lokasi-list"]),et(Ae,{"is-visible":m.value,"sale-data":M.value,onClose:st,onConfirm:ot},null,8,["is-visible","sale-data"]),et(na,{"is-visible":l.value,"product-list":C.value,"lokasi-list":I.value,"ukuran-list":N.value,onClose:y[1]||(y[1]=D=>l.value=!1),onImportSuccess:A},null,8,["is-visible","product-list","lokasi-list","ukuran-list"])]))}});export{ma as default};
